# 관리자 페이지 문서

이 문서는 `/src/app/(main)/admin` 폴더에 있는 시스템, 서비스, 에이전시 페이지의 주요 기능과 입력값, 탭별 항목을 설명합니다.

## 목차

1. [시스템 페이지](#시스템-페이지)
2. [서비스 페이지](#서비스-페이지)
3. [에이전시 페이지](#에이전시-페이지)

---

## 시스템 페이지

시스템 페이지는 플랫폼의 전반적인 설정을 관리하는 페이지입니다.

### 주요 기능

- 시스템 설정 관리
- 업로더 레벨 설정
- 가격 및 이벤트 설정
- 수동 배포 관리

### 주요 입력값

#### 시스템 설정 (SYSTEM_CONFIG)

| 설정 | 설명 | 타입 |
|------|------|------|
| videoViewTimeout | 비디오 조회 타임아웃 | 숫자 |
| videoViewThreshold | 비디오 조회 임계값 | 숫자 |
| videoViewCooldown | 비디오 조회 쿨다운 | 숫자 |
| coinToPoint | 팀마스터 수수료 (%) | 숫자 |
| enableSubscription | 구독 활성화 | 불리언 |
| enableCoinPurchase | 코인 구매 활성화 | 불리언 |

#### 업로더 레벨 설정 (UPLOADER_CONFIG)

| 설정 | 설명 | 타입 |
|------|------|------|
| uploaderQualification | 업로더 자격 요건 | 배열 |

업로더 자격 요건은 다음 필드를 가진 객체의 배열입니다:
- `level`: 레벨 번호
- `minViews`: 최소 월 조회수
- `shareRatio`: 수익률 (%)

#### 가격 및 이벤트 설정 (PRICE_EVENT)

| 설정 | 설명 | 타입 |
|------|------|------|
| subscriptionPackages | 구독 패키지 | 배열 |
| coinPackages | 코인 패키지 | 배열 |
| coinVideoPrice | 코인 비디오 가격 | 숫자 |
| freeCoinAmount | 무료 코인 수량 | 숫자 |

구독 패키지는 다음 필드를 가진 객체의 배열입니다:
- `type`: 구독 유형 (weekly, monthly)
- `price`: 한국 가격
- `globalPrice`: 글로벌 가격

코인 패키지는 다음 필드를 가진 객체의 배열입니다:
- `amount`: 코인 수량
- `price`: 한국 가격
- `globalPrice`: 글로벌 가격

### 저장 및 적용 방식

- 시스템 설정: DB 저장 + Vercel 환경변수 업데이트
- 업로더 레벨: DB 저장만
- 가격 및 이벤트: DB 저장만

---

## 서비스 페이지

서비스 페이지는 고객 서비스 관련 기능을 관리하는 페이지입니다.

### 탭 구조

1. **메인 모달 (notice)**: 메인 팝업 관리
2. **문의 (inquiry)**: 사용자 문의 관리
3. **로그 (logs)**: 시스템 로그 조회

### 메인 모달 탭

#### 주요 기능

- 메인 팝업 목록 조회
- 메인 팝업 추가/수정/삭제
- 메인 팝업 활성화/비활성화

#### 주요 입력값

| 필드 | 설명 | 타입 |
|------|------|------|
| title | 모달 제목 | 문자열 |
| priority | 우선순위 | 숫자 |
| hideOption | 숨김 옵션 | 문자열 |
| linkUrl | 링크 URL | 문자열 |
| buttonUrl | 버튼 URL | 문자열 |
| i18nData | 다국어 데이터 | 객체 |
| isActive | 활성화 여부 | 불리언 |

### 문의 탭

#### 주요 기능

- 사용자 문의 목록 조회
- 문의 상태 필터링 (대기중, 진행중, 완료)
- 날짜별 필터링
- 사용자명 검색
- 문의 상세 조회 및 응답
- 문의 상태 변경

#### 주요 입력값

| 필드 | 설명 | 타입 |
|------|------|------|
| status | 문의 상태 | PENDING, IN_PROGRESS, CLOSED |
| dateRange | 날짜 범위 | 객체 (start, end) |
| username | 사용자명 | 문자열 |
| content | 응답 내용 | 문자열 |

### 로그 탭

#### 주요 기능

- 시스템 로그 조회
- 날짜별 필터링
- 사용자 ID 필터링
- 로그 타입 필터링
- 국가별 필터링
- 로그 상세 조회

#### 주요 입력값

| 필드 | 설명 | 타입 |
|------|------|------|
| startDate | 시작 날짜 | 날짜 |
| endDate | 종료 날짜 | 날짜 |
| userId | 사용자 ID | 문자열 |
| types | 로그 타입 | 문자열 배열 |
| country | 국가 | 문자열 |
| page | 페이지 번호 | 숫자 |
| perPage | 페이지당 항목 수 | 숫자 |
| sortField | 정렬 필드 | 문자열 |
| sortOrder | 정렬 순서 | asc, desc |

---

## 에이전시 페이지

에이전시 페이지는 영업 시스템 및 포인트 분배 시스템을 관리하는 페이지입니다.

### 탭 구조

1. **설정 (settings)**: 영업 시스템 설정
2. **조회 (search)**: 영업 구조 및 포인트 분배 내역 조회

### 설정 탭

#### 주요 기능

- 본부마스터 타입 설정
- 기본 수수료 비율 설정
- 본부구조 설정
- 네트워크 설정
- 네트워크 바이너리 설정

#### 주요 입력값

| 필드 | 설명 | 타입 |
|------|------|------|
| masterType | 본부마스터 타입 | HEADQUARTERS, NETWORK, BINARY_NETWORK |
| defaultCommissionRate | 기본 수수료 비율 (%) | 숫자 |

##### 본부구조 설정

- 단계별 이름, 레벨, 수수료 비율 설정

##### 네트워크 설정

- 단계별 이름, 레벨, 수수료 비율 설정
- 중간 관리자 자동 자격 부여 설정
  - 하위회원 수
  - 충전 금액
  - 사용 금액
  - 조건 적용 방식 (하위회원 수, 충전 금액, 사용 금액, 모두 충족)

##### 네트워크 바이너리 설정

- 단계별 이름, 레벨, 수수료 비율 설정
- 중간 관리자 자동 자격 부여 설정
- 하위회원 제한 설정 (하위회원 2명이 충족될 때만 추가 회원 등록 가능)

### 조회 탭

#### 주요 기능

- 추천인 구조 조회
- 포인트 분배 내역 조회
- 통계 조회

#### 주요 입력값

##### 추천인 구조 조회

- 사용자 ID

##### 포인트 분배 내역 조회

| 필드 | 설명 | 타입 |
|------|------|------|
| year | 연도 | 문자열 |
| week | 주차 | 문자열 |

##### 통계 조회

- 사용자 ID

#### 조회 결과 데이터

##### 추천인 구조

- 사용자 ID, 사용자명, 추천인, 사용자 역할
- 에이전시 역할 (마스터 ID, 역할, 레벨, 수수료 비율)
- 하위 추천인 구조 (재귀적)

##### 포인트 분배 내역

- 사용자 ID
- 계산된 금액 (소수점 포함)
- 지급된 금액 (정수)
- 이월 금액 (소수점 이하)
- 분배 상세 정보 (마스터 ID, 마스터 타입, 수수료 비율, 금액)
- 타임스탬프

##### 통계

- 총 회원 수
- 총 에이전시 수
- 총 매니저 수
- 총 포인트
- 레벨별 회원 수
- 레벨별 포인트

---

## API 엔드포인트

### 시스템 페이지

- `GET /api/admin/settings`: 시스템 설정 조회
- `POST /api/admin/settings`: 시스템 설정 저장
- `POST /api/admin/settings/apply`: 시스템 설정 적용 (Vercel 환경변수 업데이트)

### 서비스 페이지

#### 메인 모달

- `GET /api/admin/notice-modals`: 메인 모달 목록 조회
- `POST /api/admin/notice-modals`: 메인 모달 추가
- `GET /api/admin/notice-modals/:id`: 메인 모달 상세 조회
- `PUT /api/admin/notice-modals/:id`: 메인 모달 수정
- `DELETE /api/admin/notice-modals/:id`: 메인 모달 삭제

#### 문의

- `GET /api/admin/inquiry`: 문의 목록 조회
- `PATCH /api/admin/inquiry/:id/status`: 문의 상태 변경
- `POST /api/admin/inquiry/:id/response`: 문의 응답 추가

#### 로그

- `GET ${CONFIG.WORKER_URL}/logs`: 로그 조회 (Cloudflare Worker)

### 에이전시 페이지

- `GET /api/agency/structure`: 추천인 구조 조회
- `GET /api/agency/settings`: 에이전시 설정 조회
- `POST /api/agency/settings`: 에이전시 설정 저장
- `GET /api/agency/distributions`: 포인트 분배 내역 조회
